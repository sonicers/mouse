<!DOCTYPE html>
<html style="height: 100%;">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>新泥吼</title>
    <link rel="stylesheet" type="text/css" href="css/comm.css">
    <script src="js/axios.min.js"></script>
    <script src="https://res2.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
    <script src="js/wxshare.js"></script>
    <script src="js/html2canvas.min.js"></script>
    <!-- <script src="js/weicat.js"></script> -->
    <script src="js/vconsole.min.js"></script>
</head>

<body style="height: 100%;position: relative;overflow: hidden;">
    <div id="container_1" style="height: 100%;display: block;position: relative;overflow: hidden;">
        <div id="main" style="position: relative;height: 100%;">
            <img src="img/u.png" id="text" style="position: absolute;width: 100%;bottom: 0rem;z-index: 9;" />
            <!-- <img src="img/2.png" id="circle"/>
        <img src="img/3.png" id="bottom"/> -->
            <div id="qian" style="z-index: 10;">
                <img src="img/s_0.png" id="qian_bg" />
                <img onclick="test()" src="img/5.png" id="qian_text" />
            </div>
            <!-- <div class="lot_arr" style="z-index: 9;position: absolute;bottom: 0;width: 100%;">
            <img src="img/aq_1.png" class="lot_list wobble" style="left: 30%;z-index: 94;"/>
            <img src="img/aq_2.png" class="lot_list wobble" style="left: 48%;z-index: 93;width: 25%;"/>
            <img src="img/cy.png" class="lot_list bounce" style="left: 13%;width: 33%;z-index: 96;bottom: -1.5rem;"/>
            <img src="img/jk.png" class="lot_list wobble"
                 style="left: 0;right: 0;margin: auto auto;width: 18%;z-index: 99;"/>
            <img src="img/jt.png" class="lot_list wobble" style="left: 25%;width: 32%;z-index: 98;bottom: -1.5rem;"/>
            <img src="img/jt_1.png" class="lot_list wobble"
                 style="left: 0;right: 0;margin: auto auto;bottom: 4rem;z-index: 92;width: 22%;"/>
            <img src="img/sy.png" class="lot_list bounce" style="right: 14%;bottom: -1.5rem;z-index: 95;width: 28%;"/>
            <img src="img/aq.png" class="lot_list wobble" style="left: 44%;z-index: 97;width: 29%;bottom: -1.5rem;"/>
        </div> -->
        </div>
        <img src="img/share_02.png" id="share_prompt" />
        <div id="show" style="position: absolute;height: 100%;top: 0;width: 100%;z-index: 999;">

            <!-- <img src="img/6.png" class="jieqian" id="lot"
                style="display: inline-block;height: 17.8rem;position: absolute;top: 5.2rem;left: 0;right: 0;margin: auto auto;opacity: 0;" /> -->

            <!-- <a href="javascript:;" id="jieqian" class="jieqian" style="width: 7rem;">
            <img src="img/7.png"
                 style="display: inline-block;width: 1.2rem;animation: shake 2s linear infinite;-webkit-animation: shake 2s linear infinite;"/>
            <p style="margin-top: 10px;letter-spacing: 3px;">点击解签</p>
        </a> -->
            <div id="explain" class=""
                style="position: absolute;transform: translateY(0%) translateX(0%);width: 100%;height:100%;left:0%;text-align: center;">

                <div style="display: block;width: 100%;height: 100%;position: absolute;">

                    <div id="result" style="display: block;width: 100%;height: 100%;position: absolute;">
                        <img src="img/page2_bg.png"
                            style="position: block;width: 100%;height: 100%;left:0%;position: absolute;" />
                        <img style="z-index:998;display: block;position: absolute;height: 72%;top: 8%;bottom: 20%;width: 72%;left: 14%;"
                            id="ex_img" />
                        <img src="img/default_avartar.jpg"
                            style="z-index:999;border-radius:50%;width: 12%;display: block;left:44%;position: absolute;top: 15%;"
                            id="avatar" />

                    </div>

                    <img src="img/page2_bottom_bg.png"
                        style="width: 100%;height: auto;display: block;position: absolute;bottom: 0%;" />

                    <div style="display: block;width: 100%;position: absolute;bottom: 0%;">
                        <a style="display: inline-block;width: 28%;bottom: 0%;" id="save">
                            <img src="img/11_06.png" style="display: block;width: 100%;" />
                        </a>

                        <a style="display: inline-block;width: 28%;bottom: 0%;margin-left: 12px;margin-right: 12px;margin-bottom: -10px;"
                            id="again">
                            <img src="img/11_07.png" style="display: block;width: 100%;" />
                        </a>
                        <a style="display: inline-block;width: 28%;bottom: 0%;" id="share">
                            <img src="img/11_09.png" style="display: block;width: 100%;" />
                        </a>
                    </div>


                </div>

            </div>
        </div>

        <div id="div_music" class="c_music c_rotate">
            <audio loop src="music/bg.mp3" id="audio" preload="auto"></audio>
        </div>

        <div id="mask" class="c_mask">
        </div>

        <div id="create" class="c_create">
            <p style="display: block;height:5%;text-align: center;">长按保存图片！</p>
            <div style="display: block;text-align: right;width: 72%;right: 14%;">
                <img src="img/close.png" id="iv_create_close" style="width: 10%; height: auto;">
            </div>
            <div style="display: block;position: absolute;width: 100%;height:72%; text-align: center;z-index: 1000;"
                id="final">
                <div style="z-index:100;display: block;position: absolute;width: 100%;height:100%; text-align: center;">
                    <img src="img/page2_bg.png"
                        style="display: block;position: absolute;width: 72%;height: auto;left: 14%;right: 14%;" />
                </div>

                <div style="z-index:101;display: block;position: absolute;width: 100%;height:100%;text-align: center;">
                    <img src="img/ex_1.jpg"
                        style="display: block;position: absolute;width: 60%;height:auto;top: 10%;bottom: 10%;left: 20%;right: 20%;"
                        id="ex_img_create" />
                </div>

                <img src="img/default_avartar.jpg"
                    style="border-radius:50%;z-index:999;width: 10%;display: block;left:45%;position: absolute;top: 20%;"
                    id="avatar_create" />

            </div>

            <div style="display: block;text-align: center;position: absolute;z-index: 1001;"
                style="width: 100%;height:72%; text-align: center;" id="terminal">
                <img id="img" style="width: 72%;height:100%;left: 14%;" />
            </div>
        </div>
    </div>
    <div id="container_2" style="height: 100%;background: gray;">
        <p class="prompt" style="font-size: 40px;text-align: center;">请用竖屏展示</p>
    </div>
    <script type="text/javascript" src="https://s4.cnzz.com/z_stat.php?id=1278588606&web_id=1278588606"></script>
</body>
<script type="text/javascript">
    const container_1_dom = document.getElementById("container_1");
    const container_2_dom = document.getElementById("container_2");
    const showDom = document.getElementById("show");
    const jieqianDom = document.getElementsByClassName("jieqian");
    const explainDom = document.getElementById("explain");
    const saveDom = document.getElementById("save");
    const againDom = document.getElementById("again");
    const exDom = document.getElementById("ex_img");
    const exCreateDom = document.getElementById("ex_img_create");
    // const qDom = document.getElementById("lot");
    const shareDom = document.getElementById("share");
    const sharePrompt = document.getElementById("share_prompt");
    const maskDom = document.getElementById("mask");
    const createDom = document.getElementById("create");
    const createCloseDom = document.getElementById("iv_create_close");
    const musicDom = document.getElementById("div_music");
    const audioDom = document.getElementById("audio");
    const targetDom = document.getElementById('final');
    const terminalDom = document.getElementById('terminal');


    const THRESHOLD = 1000;
    const THRESHOLD_1 = 100;//兼容低版本

    let x = 0;
    let y = 0;
    let z = 0;
    let preX = 0;
    let preY = 0;
    let preZ = 0;
    let preTime = 0;

    const exArr = [
        ["img/ex_1.jpg"],
        ["img/ex_2.jpg"],
        ["img/ex_3.jpg"],
        ["img/ex_4.jpg"],
        ["img/ex_5.jpg"],
        ["img/ex_6.jpg"],
        ["img/ex_7.jpg"],
        ["img/ex_8.jpg"],
        ["img/ex_9.jpg"],
        ["img/ex_10.jpg"],
        ["img/ex_11.jpg"],
        ["img/ex_12.jpg"],
        ["img/ex_13.jpg"],
        ["img/ex_14.jpg"],
        ["img/ex_15.jpg"],
    ];

    document.addEventListener("WeixinJSBridgeReady", function () {
        audioDom.play();
    }, false);

    rem();
    window.addEventListener('deviceorientation', handleOrientation, false);//转动

    if (window.DeviceMotionEvent) {
        window.addEventListener('devicemotion', shakeEventHandler, false);//监听的是加速度变化
    } else {
        alert('该换手机了,要不女票都被拐跑了');
    }

    maskDom.addEventListener("touchstart", function () {//点击遮罩时，遮罩消失，分享缩小
        this.style.display = "none";
        sharePrompt.style.transform = "scale(0)";
        sharePrompt.style.webkitTransform = "scale(0)";
    })

    createCloseDom.addEventListener("click", function () {//点击遮罩时，遮罩消失，分享缩小
        createDom.style.display = "none";
        terminalDom.style.display = "none";
    })

    saveDom.addEventListener("click", function () {
        createDom.style.display = "block";
        html2canvas(targetDom, {
            scale: window.devicePixelRatio,
            width: targetDom.offsetWidth * 0.72,
            height: targetDom.offsetWidth * 0.72 / 1242.0 * 2161, // 下面解决当页面滚动之后生成图片出现白边问题
            x: targetDom.offsetWidth * 0.14,
            useCORS: true // 【重要】开启跨域配置
        }).then(function (canvas) {
            var myImage = canvas.toDataURL("image/png");
            createDom.style.display = "block";
            document.getElementById("img").setAttribute("src", myImage);
            terminalDom.style.display = "block";
        });

    })

    shareDom.addEventListener("click", function () {
        sharePrompt.style.transform = "scale(1)";
        sharePrompt.style.webkitTransform = "scale(1)";
        maskDom.style.display = "block";
    }, false);

    musicDom.addEventListener("click", function () {
        musicDom.classList.toggle('c_rotate')
        if (musicDom.classList.contains('c_rotate')) {
            audioDom.play();
        } else {
            audioDom.pause();
        }
    })

    Array.prototype.forEach.call(jieqianDom, function (e) {
        e.addEventListener("touchstart", fade, false);
    })

    againDom.addEventListener("click", again, false);

    function again() {
        const i = (Math.random() * 15) | 0;
        exDom.setAttribute("src", exArr[i]);
        exCreateDom.setAttribute("src", exArr[i]);
        document.getElementById("avatar").setAttribute("src", localStorage['headimgurl']);
        document.getElementById("avatar_create").setAttribute("src", localStorage['headimgurl']);
        // showDom.style.transform = "scale(0)";
        // showDom.style.webkitTransform = "scale(0)";
        // sharePrompt.style.transform = "scale(0)";
        // sharePrompt.style.webkitTransform = "scale(0)";
        // maskDom.style.display = "none";
        // window.addEventListener('devicemotion', shakeEventHandler, false);//监听的是加速度变化
    }

    function fade() {
        document.getElementById("avatar").setAttribute("src", localStorage['headimgurl']);
        explainDom.className = "bounceInLeft";
        Array.prototype.forEach.call(jieqianDom, function (e) {
            e.style.display = "none";
        })
    }

    function handleOrientation() {//横屏的时候
        container_1_dom.style.display = "block";
        container_2_dom.style.display = "none";
        // var winHei=window.innerHeight;
        // var winWid=window.innerWidth;
        // if(winWid>winHei){//横屏的时候
        // 	container_1_dom.style.display="none";
        // 	container_2_dom.style.display="block"
        // 	container_2_dom.style.lineHeight=winHei+"px";
        // }else{
        // 	container_1_dom.style.display="block";
        // 	container_2_dom.style.display="none";
        // }
    }

    function test() {
        //alert("摇一摇有惊喜！");
        const i = (Math.random() * 15) | 0;
        exDom.setAttribute("src", exArr[i]);
        exCreateDom.setAttribute("src", exArr[i]);
        document.getElementById("avatar").setAttribute("src", localStorage['headimgurl']);
        document.getElementById("avatar_create").setAttribute("src", localStorage['headimgurl']);
        // qDom.setAttribute("src", exArr[i][1]);
        showDom.style.transform = "scale(1)";
        showDom.style.webkitTransform = "scale(1)";
        explainDom.className = "";
        Array.prototype.forEach.call(jieqianDom, function (e) {
            e.style.display = "inline-block";
        })
        window.removeEventListener('devicemotion', shakeEventHandler, false);
        preX = preY = preZ = x = y = z = 0;//参数全部重置，否则可能和上次摇一摇的结果有关联
    }

    function shakeEventHandler(event) {//摇一摇函数
        var acceleration = event.acceleration;
        var curTime = new Date().getTime();
        var diffTime = curTime - preTime;

        // alert("diffTime！" + diffTime);
        if (diffTime > 100) { //应该可以用setinterval替换
            preTime = curTime;
            x = acceleration.x;
            y = acceleration.y;
            z = acceleration.z;

            let accelerationDiff = Math.abs(x + y + z - preX - preY - preZ) / diffTime * 10000;
            let ua = navigator.userAgent;
            if (/Android (\d+\.\d+)/.test(ua)) {//获取安卓系统号
                const version = parseFloat(RegExp.$1);
                if (version <= 5.1) {//如果版本号小于5.1的话
                    if (accelerationDiff > THRESHOLD_1) {
                        //				           alert("摇一摇有惊喜！");
                        const i = (Math.random() * 15) | 0;
                        exDom.setAttribute("src", exArr[i][0]);
                        exCreateDom.setAttribute("src", exArr[i]);
                        document.getElementById("avatar").setAttribute("src", localStorage['headimgurl']);
                        document.getElementById("avatar_create").setAttribute("src", localStorage['headimgurl']);
                        // qDom.setAttribute("src", exArr[i][1]);
                        showDom.style.transform = "scale(1)";
                        showDom.style.webkitTransform = "scale(1)";
                        explainDom.className = "";
                        Array.prototype.forEach.call(jieqianDom, function (e) {
                            e.style.display = "inline-block";
                        })
                        // wx.vibrateLong()
                        window.removeEventListener('devicemotion', shakeEventHandler, false);
                        preX = preY = preZ = x = y = z = 0;//参数全部重置，否则可能和上次摇一摇的结果有关联
                        accelerationDiff = 0;//置0
                    }
                }
            }
            if (accelerationDiff > THRESHOLD) {
                //alert("摇一摇有惊喜！");
                var i = (Math.random() * 15) | 0;
                exDom.setAttribute("src", exArr[i][0]);
                document.getElementById("avatar_create").setAttribute("src", localStorage['headimgurl']);
                exCreateDom.setAttribute("src", exArr[i]);
                // qDom.setAttribute("src", exArr[i][1]);
                showDom.style.transform = "scale(1)";
                showDom.style.webkitTransform = "scale(1)";
                explainDom.className = "";
                Array.prototype.forEach.call(jieqianDom, function (e) {
                    e.style.display = "inline-block";
                })
                // wx.vibrateLong()
                window.removeEventListener('devicemotion', shakeEventHandler, false);
                preX = preY = preZ = x = y = z = 0;//参数全部重置，否则可能和上次摇一摇的结果有关联
            }
        }
    }

    function rem() {//响应式函数
        const add = 0.05//(96-16)/(1920-320)
        const htmlDom = document.getElementsByTagName("html")[0]
        const htmlWidth = htmlDom.clientWidth
        const fontSize = (htmlWidth - 320) * add + 16
        htmlDom.style.fontSize = fontSize + "px";
    }
    // init vConsole
    var vConsole = new VConsole();
    console.log('Hello world');
</script>

</html>